<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>COVID-19 MODEL</title>
    <script
      src="https://kit.fontawesome.com/dafd3ebce7.js"
      crossorigin="anonymous"
    ></script>
  </head>

  <body id="mainPage">
    <div class="headerMenu">
      <div class="headerElement l">
        <span
          style="font-size: 50px; cursor: pointer; color: white;"
          onclick="openNav()"
          >&#9776;
        </span>
      </div>
      <div class="headerElement m" style="background-color: #aaa;">
        <!-- <i class="fas fa-temperature-low"></i> -->
        <i class="fas fa-cloud-sun"></i>
      </div>
      <div class="headerElement r" style="background-color: #aaa;">
        <!-- <h1>COVID-19 AGENT-BASED SIMULATION MODEL</h1> -->
        <h1>The Corona Forecast</h1>
      </div>
    </div>

    <div id="myNav" class="sidenav">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()"
        >&times;</a
      >
      <div id="sliderDIV">
        <div class="tooltipR-PM" id="PMDIV">
          <h2>Parameters</h2>
          <span class="tooltiptextR-PM"
            >Click on the categories below and move sliders to adjust respective
            values.</span
          >
        </div>

        <button class="accordion">Initial Model Setup</button>
        <div class="panel">
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Initial number of susceptibles:</p>
              <span class="tooltiptextR-PM" id="t24"
                >How many non infectious agents the model starts with(reload
                after altering)</span
              >
            </div>
            <input
              type="range"
              min="100"
              max="5000"
              value="100"
              step="20"
              class="slider"
              id="initSusceptible"
            />
            <div class="outputContainer">
              <output id="initSusceptibleCount" for="initSusceptible"
                >50</output
              >
            </div>
            <!-- <input type="number" id="initSusceptibleCount" name="initSusceptibleCount" min="100" max="500" value="100"> -->
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Initial number of infectious:</p>
              <span class="tooltiptextR-PM" id="t25"
                >How many infectious agents the model starts with(reload after
                altering)</span
              >
            </div>
            <input
              type="range"
              min="1"
              max="200"
              value="1"
              step="5"
              class="slider"
              id="initInfectious"
            />
            <div class="outputContainer">
              <output id="initInfectiousCount" for="initInfectious">3</output>
            </div>
            <!-- <input type="number" id="initSymptomaticCount" name="initSymptomaticCount" min="1" max="20" value="1"> -->
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Number of communities:</p>
              <span class="tooltiptextR-PM" id="t26"
                >How many communities there are in the model(reload after
                altering)</span
              >
            </div>
            <input
              type="range"
              min="1"
              max="12"
              step="1"
              class="slider"
              id="numCommunities"
            />
            <div class="outputContainer">
              <output id="numCommunitiesOut" for="numCommunities">4</output>
            </div>
          </div>
        </div>

        <button class="accordion">Interaction Parameters</button>
        <div class="panel">
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Social Distancing:</p>
              <span class="tooltiptextR-PM" id="t8"
                >Extent to which agents repel other agents-being socially
                distant</span
              >
            </div>

            <input
              type="range"
              min="0"
              max="100"
              value="0"
              step="0.05"
              class="slider"
              id="repulsionForce"
            />
            <div class="outputContainer">
              <output id="repulsionForceOut" for="repulsionForce">0</output>
            </div>
            <!-- <input type="number" id="initSusceptibleCount" name="initSusceptibleCount" min="100" max="500" value="100"> -->
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Attraction:</p>
              <span class="tooltiptextR-PM" id="t9"
                >Extent to which agents are attracted to community center.</span
              >
            </div>

            <input
              type="range"
              min="0"
              max="100"
              value="0"
              step="0.05"
              class="slider"
              id="attractionForce"
            />
            <div class="outputContainer">
              <output id="attractionForceOut" for="attractionForce">
                0
              </output>
            </div>
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Probability of testing positive:</p>
              <span class="tooltiptextR-PM" id="t11"
                >Probability infectious agents show symptoms and get tested
                positive</span
              >
            </div>

            <input
              type="range"
              min="0"
              max="1"
              value="0.5"
              step="0.05"
              class="slider"
              id="testedPositiveProb"
            />
            <div class="outputContainer">
              <output id="testedPositiveProbOut" for="testedPositiveProb">
                0.5
              </output>
            </div>
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Infectivity reduction factor:</p>
              <span class="tooltiptextR-PM" id="t12"
                >Reduces infectivity of a positive tested agent</span
              >
            </div>

            <input
              type="range"
              min="1"
              max="10"
              value="3"
              step="0.5"
              class="slider"
              id="InfectionRadiusRedFactor"
            />
            <div class="outputContainer">
              <output
                id="InfectionRadiusRedFactorOut"
                for="InfectionRadiusRedFactor"
              >
                3
              </output>
            </div>
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Probability of moving to ICU:</p>
              <span class="tooltiptextR-PM" id="t13"
                >Fraction of infected with critical condition</span
              >
            </div>

            <input
              type="range"
              min="0"
              max="1"
              value="0.1"
              step="0.05"
              class="slider"
              id="IcuProb"
            />
            <div class="outputContainer">
              <output id="IcuProbOut" for="icuProb">
                0.1
              </output>
            </div>
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">ICU capacity per community</p>
              <span class="tooltiptextR-PM" id="t14"
                >Number of ICU beds available per community</span
              >
            </div>
            <input
              type="range"
              min="0"
              max="20"
              value="5"
              step="1"
              class="slider"
              id="IcuCapacity"
            />
            <div class="outputContainer">
              <output id="IcuCapacityOut" for="IcuCapacity">
                5
              </output>
            </div>
          </div>
        </div>

        <button class="accordion">Agent Parameters</button>
        <div class="panel">
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Probability a collision will result in infection</p>
              <span class="tooltiptextR-PM" id="t15"
                >After contact with an infectious-chance you will get the
                disease</span
              >
            </div>
            <input
              type="range"
              min="0.00"
              max="1.00"
              step="0.05"
              value="0.90"
              class="slider"
              id="transmissionProb"
            />
            <div class="outputContainer">
              <output id="transmissionProbOut" for="transmissionProb"
                >90%
              </output>
            </div>
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">
                Probability a non-infectious agent becomes immune
              </p>
              <span class="tooltiptextR-PM" id="t16">
                Probability a non-infectious agent becomes directly immune post
                incubation</span
              >
            </div>
            <input
              type="range"
              min="0.00"
              max="1.00"
              step="0.05"
              value="0.1"
              class="slider"
              id="nonInToImmuneProb"
            />
            <div class="outputContainer">
              <output id="nonInToImmuneProbOut" for="nonInToImmuneProb"
                >10%</output
              >
            </div>
          </div>
          <!-- <div class="col-sm">
            <p>Size of agents</p>
            <input
              type="range"
              min="0"
              max="10"
              value="1.5"
              step="0.1"
              class="slider"
              id="agentRadius"
            />
            <div class="outputContainer">
              <output id="agentRadiusOut" for="agentRadius">2</output>
            </div>
          </div> -->

          <div class="row">
            <div class="col-sm">
              <div class="tooltipR-PM" id="PMDIV">
                <p class="tp">Minimum incubation time</p>
                <span class="tooltiptextR-PM" id="t17"
                  >The time it takes for an agent to start infecting others
                  after infection</span
                >
              </div>
              <input
                type="range"
                min="1"
                max="7"
                value="7"
                step="1"
                class="slider"
                id="minIncubationTime"
              />
              <div class="outputContainer">
                <output id="minIncubationTimeOut" for="minIncubationTime"
                  >7 days</output
                >
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm">
              <div class="tooltipR-PM" id="PMDIV">
                <p class="tp">Maxmimum incubation time</p>
                <span class="tooltiptextR-PM" id="t18"
                  >The max. time it takes for an agent to start infecting others
                  after infection</span
                >
              </div>
              <input
                type="range"
                min="8"
                max="14"
                value="14"
                step="1"
                class="slider"
                id="maxIncubationTime"
              />
              <div class="outputContainer">
                <output id="maxIncubationTimeOut" for="maxIncubationTime"
                  >14 days</output
                >
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm">
              <div class="tooltipR-PM" id="PMDIV">
                <p class="tp">Minimum time a patient is infectious</p>
                <span class="tooltiptextR-PM" id="t19"
                  >The min. time for which infectious agents infect others</span
                >
              </div>
              <p>
                <input
                  type="range"
                  min="1"
                  max="6"
                  value="5"
                  step="1"
                  class="slider"
                  id="minInfectiousTime"
                />
              </p>

              <div class="outputContainer">
                <output id="minInfectiousTimeOut" for="minInfectiousTime"
                  >5 days</output
                >
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm">
              <div class="tooltipR-PM" id="PMDIV">
                <p class="tp">Maximum time a patient is infectious</p>
                <span class="tooltiptextR-PM" id="t20"
                  >The max. time for which infectious agents infect others</span
                >
              </div>
              <input
                type="range"
                min="7"
                max="11"
                value="10"
                step="1"
                class="slider"
                id="maxInfectiousTime"
              />
              <div class="outputContainer">
                <output id="maxInfectiousTimeOut" for="maxInfectiousTime"
                  >10 days</output
                >
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm">
              <div class="tooltipR-PM" id="PMDIV">
                <p class="tp">Minimum time from end of incubation to death.</p>
                <span class="tooltiptextR-PM" id="t21"
                  >The min. time needed for an agent to die after they turn
                  infectious</span
                >
              </div>
              <input
                type="range"
                min="1"
                max="16"
                value="15"
                step="1"
                class="slider"
                id="minTimeUntilDead"
              />
              <div class="outputContainer">
                <output id="minTimeUntilDeadOut" for="minTimeUntilDead"
                  >15 days</output
                >
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm">
              <div class="tooltipR-PM" id="PMDIV">
                <p class="tp">Maximum time from end of incubation to death.</p>
                <span class="tooltiptextR-PM" id="t22"
                  >The max. time until an agent dies after they turn
                  infectious</span
                >
              </div>
              <input
                type="range"
                min="17"
                max="35"
                value="30"
                step="1"
                class="slider"
                id="maxTimeUntilDead"
              />
              <div class="outputContainer">
                <output id="maxTimeUntilDeadOut" for="maxTimeUntilDead"
                  >30 days</output
                >
              </div>
            </div>
          </div>

          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">
                Circle of infection (how many people one person can infect at
                once)
              </p>
              <span class="tooltiptextR-PM" id="t23"
                >From how far an agent can infect someone</span
              >
            </div>
            <input
              type="range"
              min="1"
              max="20"
              value="2"
              class="slider"
              id="infectionCircleRadius"
            />
            <div class="outputContainer">
              <output id="infectionRadiusOut" for="infectionCircleRadius"
                >5</output
              >
            </div>
          </div>
        </div>

        <button class="accordion">Rules list</button>
        <div class="panel">
          <div id="rulesDIV"></div>
        </div>

        <button class="accordion">Add a time-based rule</button>
        <div class="panel">
          <p>
            Select the interaction parameter you want to add a rule for. Use the
            sliders to select both when you want the rule to be active and the
            value you want this parameter to be during the selected period of
            time. If the rule is not added, it means that it overlaps with a
            current rule already in the timeline. First, delete the conflicting
            rule from the Rules List and then add it again.
          </p>
          <div id="timeline-form">
            <div id="timeline-simple-form">
              <div id="dropdown-simple-form">
                <select class="select-css" id="timelineform-simple-target">
                  <option value="soc">Social distancing</option>
                  <option value="atc">Attraction to the center</option>
                </select>
              </div>

              <div class="slider-container rule-slider">
                <div class="slider-title">Time rule is active</div>
                <div class="new-slider" id="timelineTimeSlider"></div>
              </div>

              <div class="slider-container rule-slider">
                <div class="slider-title">Value</div>
                <div class="new-slider" id="timelineTimeValueSlider"></div>
              </div>

              <button id="timeline-add-simple-rule">+</button>
            </div>
          </div>
        </div>

        <button class="accordion">Add a threshold-based rule</button>
        <div class="panel">
          <div id="timeline-form">
            <div id="timeline-threshold-form">
              <select class="select-css" id="timelineform-threshold-target">
                <option value="soc">Social distancing</option>
                <option value="atc">Attraction to the center</option>
              </select>
              <select class="select-css" id="timelineform-threshold-param">
                <option value="inf">Infected people</option>
                <option value="icu">ICU </option>
              </select>
              <label for="timelineform-threshold-trigger">Threshold: </label>
              <input type="text" id="timelineform-threshold-trigger" />

              <div class="slider-container">
                <div class="slider-title">Value</div>
                <div class="new-slider" id="timelineform-threshold-value"></div>
              </div>

              <button id="timeline-add-threshold-rule">+</button>
            </div>
          </div>
        </div>

        <button class="accordion">Presets</button>
        <div class="panel">
          <div class="preset-panel">
            <div class="custom-select" style="width: 250px;">
              <select id="preset-list"> </select>
            </div>

            <div class="button-div">
              <button type="button" id="select" class="btn btn-preset">
                Select
              </button>
            </div>
          </div>
        </div>

        <div class="row p-3">
          <button type="button" id="reload" class="btn btn-secondary">
            Reload
          </button>
          <button class="btn btn-secondary" id="download">Download Data</button>
        </div>
      </div>
    </div>

    <script>
      function openNav() {
        document.getElementById('myNav').style.width = '45%';
      }

      function closeNav() {
        document.getElementById('myNav').style.width = '0%';
      }
    </script>

    <script>
      var acc = document.getElementsByClassName('accordion');
      var i;

      for (i = 0; i < acc.length; i++) {
        acc[i].addEventListener('click', function () {
          this.classList.toggle('active');
          var panel = this.nextElementSibling;
          if (panel.style.maxHeight) {
            panel.style.maxHeight = null;
          } else {
            panel.style.maxHeight = panel.scrollHeight + 'px';
          }
        });
      }
    </script>

    <main id="main">
      <div id="left-panel">
        <div id="title-container">
          <h4>Simulation Chart</h4>
          <h5>The distribution of the population over the five states.</h5>
          <i class="fa fa-question-circle tooltip-icon"></i>
          <span class="tooltip-text">
            As the model runs, the proportion of agents in each state changes,
            which can be seen in this chart. As the time increases, you will
            notice that the amount of susceptible agents (represented by the
            blue colour) begins to decrease, while the number of infectious
            agents (represented by the red colour) increases. The number of
            agents is displayed on the vertical axis and the day number of the
            simulation is displayed on the horizontal axis. The model runs for a
            total of 365 days (one year), after which it stops. You can use the
            legend above the chart to see which colour corresponds to which
            state. Also, using the buttons below the chart, you can either pause
            or play the model (left button), or you can restart it (right
            button). Finally, under the chart you can see how many days have
            passed in the model.
          </span>
        </div>
        <div id="chart-container">
          <canvas id="chart-canvas" height="400px"></canvas>
        </div>
        <div id="time-control-bar">
          <button id="time-control-toggle-pause-button">
            <i class="fas fa-pause" style="font-size: 22px;"></i
            ><i class="fas fa-play" style="font-size: 17px;"></i>
          </button>
          <button id="time-control-reset-button">
            <i class="fas fa-undo" style="font-size: 22px;"></i>
          </button>
          <span id="time-control-days-display"></span>
        </div>

        <div id="title-container">
          <h4>Demographics Chart</h4>
          <h5>
            An overview of the amount of agents in each state in each age and
            gender category.
          </h5>

          <i class="fa fa-question-circle tooltip-icon"></i>
          <span class="tooltip-text">
            Demography is the statistical study of populations, especially human
            beings. Every single agent in the model is assigned an age and
            gender, which affects their chance of survival if they become
            infected. This chart displays the amount of agents in each state,
            divided by age and gender. The statistics regarding the current
            males is on the left half of the chart, while that of the females is
            on the right. The age ranges are on the vertical axis. This chart
            shows the spread of infection across different age group and
            demostrates trends found in coronavirus data, most notably that
            older, male patiests have the highest mortality rate.
          </span>
        </div>
        <div id="gender-label">
          <h6>Male</h6>
          <h6>Female</h6>
        </div>

        <div id="demographics-container">
          <canvas id="demographics"></canvas>
        </div>
      </div>
      <div id="right-side-container">
        <div id="title-container">
          <h4>Agent-Based Model</h4>
          <h5>
            The model in which agents interact with each other over time and
            demostrate how the coronavirus spreads.
          </h5>
          <i class="fa fa-question-circle tooltip-icon"></i>
          <span class="tooltip-text">
            The agent-based model is a graphical representation of our
            agent-based simulation. The dots represent agents, which reflect the
            behaviour of people in real life. They have characteristics like
            "social distancing" and "attraction to the centre of the model"
            which you can change to alter the respective behaviour of the
            agents. Every agent has a color which is an indication of their
            current state. You can click on the red "Get started!" button to
            learn more about these states and how agents move between them. All
            agents reside in communities, seperated using white borders. These
            communities model real life cities and agents can relocate between
            different communities, which can be seen as agents jumping from one
            community to another. To learn more about the model parameters and
            to test out how different values in these parameters affect the
            behaviour of agents in the model, check out the Parameter Menu.
          </span>
        </div>
        <div id="model-border-canvases-container">
          <canvas id="glCanvas" width="600px" height="600px"></canvas>
          <!-- This canvas is used for drawing a border around each community so must have same witdth and height.it is overlapped with the main agent canvas-->
          <canvas id="BorderCanvas" width="600px" height="600px"></canvas>
        </div>
        <div class="statrow">
          <div class="stat" style="background-color: #05befc;">
            <h3>Susceptible</h3>
            <p id="s1"></p>
          </div>
          <div class="stat" style="background-color: #c9e265;">
            <h3>Non-Infectious</h3>
            <p id="s2"></p>
          </div>
          <div class="stat" style="background-color: #fd7e65;">
            <h3>Infectious</h3>
            <p id="s3"></p>
          </div>
          <div class="stat" style="background-color: #a6a6a6;">
            <h3>Immune</h3>
            <p id="s4"></p>
          </div>
          <div class="stat" style="background-color: #000000;">
            <h3>Dead</h3>
            <p id="s5"></p>
          </div>
          <div class="stat" id="icuDIV" style="background-color: green;">
            <h3>In ICU</h3>
            <p id="s6"></p>
          </div>
        </div>
        <div id="title-container">
          <h4>Parameter Timeline</h4>
          <h5>
            The time-based and threshold-based rules that are active in the
            model over time.
          </h5>
          <i class="fa fa-question-circle tooltip-icon"></i>
          <span class="tooltip-text">
            When the pandemic first began, different countries took different
            stances on which policies to implement to slow the spread of the
            coronavirus. One policy that became very common was social
            distancing, which is where people actively avoid close contact with
            one another. Once restrictions are lifted, people might meet up
            again at central locations. These are behaviours that are seen at
            different points of time, which is what this timeline is for. In the
            Parameter Menu, you can add time-based rules, where the value of
            social distancing or an agent's attraction to the center can be
            different values over different periods of time. Another rule you
            can create in the Parameter Menu is a threshold-based rule. For
            these rules, you can enforce that once the number of infectious
            agents, or the number of agents in the ICU has surpassed a certain
            threshold, a certain social distancing or attraction value can
            become active. In the timeline, the white vertical line represents
            how far the model has been running and you can also see a list of
            the rules that are in place. If a rule is active, you will see the
            title of the rule become darker.
          </span>
        </div>
        <div id="timeline">
          <div>
            <canvas id="timeline-element" width="600" height="50%">
              Days: 0
            </canvas>
          </div>
        </div>
      </div>
    </main>

    <button id="get-started-btn">Get started!</button>
    <div id="myModal" class="modal">
      <div class="modal-content">
        <span class="modal-close">&times;</span>
        <div id="modal-text">
          <h7>Welcome to the Corona Forecast!</h7>
          <p>
            Here lies before you an agent-based predictive model for the
            coronavirus.
          </p>

          <p>
            Not sure what that means? On the right side of the screen you'll
            notice an animation with a bunch of dots running around. This
            collection of dots represents a given population and each of these
            dots is called an “agent” and represents a person within a
            population. By introducing some infected agents to this population,
            we can model the spread of a virus over time and estimate how it
            will spread through the population in the future.
          </p>

          <h6>Data and Parameter Values</h6>

          <p>
            Our model is based upon the behaviour of the coronavirus, a virus
            that at the time of the creation of this model is spreading across
            the world and dramatically changing the way we are living. As this
            project began in the Netherlands, the population and transmission
            data is based upon that which is recorded by the United Nations and
            the RIVM (Rijksinstituut voor Volksgezondheid en Milieu).
          </p>

          <h6>Agent States</h6>

          <p>The population is divided into five states:</p>

          <ol>
            <li>
              Susceptible: an agent that has not been exposed to the virus.
            </li>
            <li>
              Non-infectious: an agent that has been infected, but is in the
              incubation period.
            </li>
            <li>
              Infectious: an infected agent that has passed the incubation
              period and can now infect other agents.
            </li>
            <li>Immune: an agent that was infected, but is now resistant.</li>
            <li>
              Dead: an agent that has been killed as a result of infection.
            </li>
          </ol>

          <p>
            Here is a diagram of how they move between these states throughout
            the simulation:
          </p>

          <img
            src="./public/images/states (2).png"
            alt="States of the model"
            id="states-image"
          />

          <h6>Tuning Model Parameters</h6>

          <p>
            On the right side of the screen, you can see the model, where agents
            are moving and interacting. You can tune the epidemic parameters in
            the side-bar menu to change how the virus spreads throughout the
            agent population. There are numerous visuals on the page that
            provide visual feedback on the model. By hovering over the question
            mark icons next to each visual, you can learn more about what it is
            showing you.
          </p>

          <h6>Disclaimer</h6>
          <p>
            This application can be used to model the virus behaviour and
            estimate its spread. By no means is this an accurate model. It
            simply allows you to see the effect of multiple parameters on the
            spread of the virus.
          </p>
        </div>
      </div>
    </div>

    <script>
      // Get the modal
      var modal = document.getElementById('myModal');

      // Get the button that opens the modal
      var btn = document.getElementById('get-started-btn');

      // Get the <span> element that closes the modal
      var span = document.getElementsByClassName('modal-close')[0];

      // When the user clicks the button, open the modal
      btn.onclick = function () {
        modal.style.display = 'block';
      };

      // When the user clicks on <span> (x), close the modal
      span.onclick = function () {
        modal.style.display = 'none';
      };

      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = 'none';
        }
      };
    </script>

    <div class="footer">
      <p>
        You're free to use this work however you see fit, including copying it,
        modifying it, and distributing it on your own site.
      </p>
    </div>
  </body>
</html>
